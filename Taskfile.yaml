# spell-checker: disable
---
version: '3'

tasks:
  init:
    cmds:
      - deno cache --reload --lock=deno.lock deps.mts dev_deps.mts

  check:
    cmds:
      - deno fmt --check
      - deno lint

  build:
    cmds:
      - task: clean
      - cmd: jq --raw-input --slurp < src/template.eta > src/template.json
      - cmd: deno compile --cached-only -A --target {{.ITEM}} --output .build/magpie-{{.ITEM}} src/cli.mts
        for:
          - x86_64-unknown-linux-gnu
          - aarch64-unknown-linux-gnu
          - x86_64-apple-darwin
          - aarch64-apple-darwin
          - x86_64-pc-windows-msvc

  cache:
    sources:
      - deps.mts
      - dev_deps.mts
    generates:
      - deno.lock
    cmd: deno cache --lock=deno.lock --lock-write deps.mts dev_deps.mts

  clean: rm -rf .build/*
